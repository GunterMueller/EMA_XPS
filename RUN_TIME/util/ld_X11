#!/bin/sh
########################################################
#   ld_X11           Hans Groschwitz       16.08.96    # 
#                                                      #
#   This workarounds the missing GNU configure.        #
#   See file util/PORTING for hints.                   #
#   Watch out the different libs for Motif 1.2 vs. 2.0 #
########################################################

if [ _$EMAXPS_BINDING = _static ]; then
  mode="s"
else
  mode="d"
fi

uname=`uname`    ### Nesting in brackets voids settings from toplevel!


########### static #############
if   [ $mode = s -a $uname = Linux ]; then
   cc="gcc"
   xlibs="-static -L/usr/X11R6/lib -L/usr/X11/lib -lXm -lXpm -lXt -lXext -lX11 -lSM -lICE"

elif [ $mode = s -a $uname = CYGWIN_NT-5.1 ]; then
   ## Cygwin@WinXP + OpenMotif230

   echo '#############################################' 1>&2
   echo '## -static does not work with Cygwin:' 1>&2
   echo '## X11 libs are available as DLL versions only!' 1>&2
   echo '#############################################' 1>&2
   exit -1

elif [ $mode = s -a $uname = SunOS ]; then
   cc="gcc"
   xlibs="-static -L/usr/X11/lib -lXm -lXt -lXext -lX11"

########### dynamic ############
elif [ $mode = d -a $uname = Linux ]; then
   cc="gcc"
   xlibs="-L/usr/X11R6/lib -L/usr/X11/lib -lXm -lXpm -lXt -lXext -lX11 -lSM -lICE"

elif [ $mode = d -a $uname = CYGWIN_NT-5.1 ]; then
   ## Cygwin@WinXP + OpenMotif230

   (if [ -f /usr/X1R6/lib/libXm.dll.a ]; then
     echo '#############################################' 1>&2
     ls -al /usr/X1R6/lib/libXm.dll.a 1>&2
     echo "##" 1>&2
     echo "## Lesstif shared libs MUST be deinstalled first!" 1>&2
     echo "## v0.94 is NOT an adaequate replacement for OpenMotif!" 1>&2
     echo "## Sorry, too many bugs and flaws yet!" 1>&2
     echo '#############################################' 1>&2
     exit -1
   fi)

   ## args + library list derived from autogenerated openmotif Makefile!
   ## DO NOT ADD: " -Wl,--enable-runtime-pseudo-reloc"
   cc="gcc -Wl,--enable-auto-import"

   ## The OpenMotif libXm libtool reports problems with unresolved symbols
   ## not allowed with cygwin and shared libraries. This is worked arround
   ## in xext.c for EMA-XPS.
   ## For the demo programs shipped with Motif this means: they are not
   ## runnable in an Cygwin environment!

   xlibs="-L/usr/X11R6/lib -lXm -lXmu -lXt -lXft -lXp -lXrender -lX11 -lXext -liconv -lfreetype -lz -lfontconfig -lexpat -ljpeg -lpng"


elif [ $mode = d -a $uname = SunOS ]; then
   cc="gcc"
   xlibs="-lXm -lXt -lXext -lX11"

elif [ $mode = d -a $uname = IRIX ]; then
   cc="gcc"
   xlibs="-lXm -lXt -lX11"

elif [ $mode = d -a $uname = AIX   ]; then
   cc="cc"
   xlibs="-lXm -lXt -lXext -lX11"

elif [ $mode = d -a $uname = HP-UX ]; then
   cc="gcc"
   xlibs="-L/usr/lib -L/usr/lib/Motif1.2 -L/usr/lib/X11R5 -lXm -lXt -lXext -lX11"

############ void ##############
else
   echo "$uname is currently unsupported!" 1>&2
   exit -1
fi




if [ $mode = d ]; then
  echo "Dynamic Binding..." 1>&2
else
  echo "Static Binding ..." 1>&2
fi

echo "$uname: $cc $* $xlibs" 1>&2

exec $cc $* $xlibs

### eof
